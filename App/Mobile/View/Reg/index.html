<include file="Public:header"/>
<body>
<div class="dl">
    <div class="dl_h">
        <i></i>
        <span>云链口袋</span>
    </div>
    <div class="errmsg">
        <!--<i class="tipmsg">注册成功</i>-->
    </div>
    <div class="dl_c">
        <ul>
            <li>
                <i class="phone"></i>
                <input type="text" name="phone" id="phone" placeholder="请输入手机号码" >
            </li>
            <li>
                <i class="lock"></i>
                <input type="password" style="width: 78%" name="password" id="password" placeholder="请输入登录密码" >
                <em class="eye"></em>
            </li>
            <li>
                <i class="yqm"></i>
                <input type="text"  name="pid" id="pid"  placeholder="请输入邀请码" <if condition="$pid">value="{$pid}" readonly="readonly"</if>  >
            </li>
            <li class="sms_c">
                <i class="sms"></i>
                <input  type="text" name="yzm" id="yzm" placeholder="请输入短信码" >
                <em class="get_code" onclick="get_code()" id="msgt">获取验证码</em><!--重新获取 57-->
            </li>
            <!--<div class="yzmmsg"></div>-->
            <!--<div class="yzmmsg">验证码已发送，请耐心等待</div>-->
        </ul>
        <div class="dl_tips">
            <a class="wjmm" href="{:U('Login/setphone')}">忘记密码?</a>
            <a class="sjdl" href="{:U('Login/index')}">手机登录</a>
        </div>
        <div class="btn">
            <a class="dl_btn" onclick="reg()">立即注册</a>
        </div>
        <p class="bzzh">
            <i></i>
            <span>重泰保险保你账号安全</span>
        </p>
    </div>
</div>
<script>

    $(".eye").click(function () {
        if($(this).attr('active') == 1){
            $(this).prev('input').attr('type','password');
            $(this).attr('active',2)
        }else{
            $(this).prev('input').attr('type','text');
            $(this).attr('active',1)
        }

    })
    $(".eye").click(function () {
        if($(this).attr('active') == 1){
            $(this).prev('input').attr('type','password');
            $(this).attr('active',2)
        }else{
            $(this).prev('input').attr('type','text');
            $(this).attr('active',1)
        }
    });
    $(".dl_c").on('input propertychange',function () {
        var is_write = 1;
        $(".dl_c").find('input').each(function () {
            if($(this).val() == ''){
                is_write = 0;
            }
        });
        if(is_write == 1){
            $(".btn .dl_btn").attr('class','dl_btn active')
        }else{
            $(".btn .dl_btn").attr('class','dl_btn')
        }
    });
    function get_code(){
        var phone = $("input[name='phone']").val();
        if(phone == ""||phone == null){
            layer.msg('请输入手机号码');
            return false;
        }
        if(!Utils.isTel(phone)){
            layer.msg('手机号格式错误');
            return false;
        }
        $("#msgt").attr("data-key","off");
        var i= 60;
        var timer =setInterval(function(){
            if($("#msgt").attr("data-key")=='off'){
                $("#msgt").attr("disabled",true).css("pointer-events","none");
                $("#msgt").attr('class','get_code active');
                i--;
                $("#msgt").text("重新获取 "+i);
                if(i<=0){
                    $("#msgt").removeAttr("disabled").text("获取验证码");
                    $("#msgt").attr("data-key","on");
                    $("#msgt").css("pointer-events","auto");
                    $("#msgt").attr('class','get_code');
                    clearInterval(timer);
                }
            }
        },1000);
        $.post("{:U('Common/ajaxSandPhone')}",
            {'phone':phone,type:1},function(d){
                if(d.status == 1){
                    layer.msg(d.info,{icon:1});
                }else{
                    layer.msg(d.info);
                }
            });
    }
    function reg(){
        var pid = $("#pid").val();
        var phone = $("#phone").val();
        var pwd = $("#password").val();
        var yzm = $("#yzm").val();

        if(phone == ""||phone == null){
            layer.msg('请输入手机号码');
            return false;
        }
        if(!Utils.isTel(phone)){
            layer.msg('手机号格式错误');
            return false;
        }

        if(pwd==""||pwd==null){
            layer.msg('请输入登陆密码');
            return false;
        }
        if(!Utils.isPasswd(pwd)){
            layer.msg('密码为8位以上数字或字母');
            return false;
        }

        var pLen = pwd.length;
        if(pLen < 8 || pLen > 16) {
            layer.msg('密码长度在8-16个字符之间');
            return false;
        }
//        var repwd = $("#repwd").val();
//        if(repwd!= pwd) {
//            layer.msg('登陆密码不一致，请重新输入');
//            return false;
//        }

        $.post("{:U('Reg/addReg')}",{
            pid:pid,
            phone:phone,
            pwd:pwd,
            yzm:yzm
        },function(data){
            if(data.status==1){
                layer.msg(data.info,{icon:1});
                window.setTimeout(function(){
                    window.location="{:U('Login/index')}";
                },1000);
            }else{
                layer.msg(data.info);
                return false;
            }
        })
    };
</script>
<include file="Public:footer"/>


